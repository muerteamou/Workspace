DROP DATABASE IF EXISTS PROCEDIMIENTOS;
CREATE DATABASE PROCEDIMIENTOS;
USE PROCEDIMIENTOS;

CREATE TABLE centros (
	numce INTEGER,
	nomce VARCHAR(25),
	seas VARCHAR(30),
  PRIMARY KEY (numce));

CREATE TABLE departamentos (
	numde INTEGER,
  	numce INTEGER,
	direc INTEGER,
	tidir CHAR(1),
	presu INTEGER,
	depde INTEGER,
	nomde VARCHAR(20),
	PRIMARY KEY (numde),
	FOREIGN KEY (numce) REFERENCES 	centros (numce)
);


CREATE TABLE empleados (
	numem INTEGER,
	numde INTEGER,
	extel INTEGER,
	fecna DATE,
	fecin DATE,
	salario INTEGER,
	comision INTEGER,
	numhi INTEGER,
	nomem VARCHAR(18),
	PRIMARY KEY (numem),
	FOREIGN KEY (numde) REFERENCES departamentos  (numde)
);


INSERT INTO centros VALUES (10, 'SEDE CENTRAL', 'C/ ALCALA, 820 - MADRID');
INSERT INTO centros VALUES (20, 'RELACION CON CLIENTES', 'C/ ATOCHA, 405 - MADRID');


INSERT INTO departamentos VALUES (100, 10, 260, 'P', 12000000,NULL, 'DIRECCCION GENERAL');
INSERT INTO departamentos VALUES (110, 20, 180, 'P', 15000000, 100, 'DIRECCION COMERCIAL');
INSERT INTO departamentos VALUES (111, 20, 180, 'F', 11000000,110, 'SECTOR INDUSTRIAL');
INSERT INTO departamentos VALUES (112, 20, 270, 'P', 9000000,110, 'SECTOR SERVICIOS');
INSERT INTO departamentos VALUES (120, 10, 150, 'F', 3000000,100, 'ORGANIZACION');
INSERT INTO departamentos VALUES (121, 10, 150, 'P', 2000000,120, 'PERSONAL');
INSERT INTO departamentos VALUES (122, 10, 350, 'P', 6000000,120, 'PROCESO DE DATOS');
INSERT INTO departamentos VALUES (130, 10, 310, 'P', 2000000,100, 'FINANZAS');

INSERT INTO empleados VALUES(110, 121, 350,'1939/11/10', '1960/02/15', 310, NULL, 3, 'PONS, CESAR');
INSERT INTO empleados VALUES(120, 112, 840,'1945/06/09', '1978/10/01', 350, 110, 1, 'LASA, MARIO');
INSERT INTO empleados VALUES(130, 112, 810,'1955/09/09', '1979/02/01', 290, 110, 2, 'TEROL, LUCIANO');
INSERT INTO empleados VALUES(150, 121, 340,'1940/08/10', '1958/01/15', 440, NULL, 0, 'PEREZ, JULIO');
INSERT INTO empleados VALUES(160, 111, 740,'1949/07/09', '1978/11/11', 310, 110, 2, 'AGUIRRE, AUREO');
INSERT INTO empleados VALUES(180, 110, 508,'1944/10/18', '1966/03/18', 480, 50, 2, 'PEREZ, MARCOS');
INSERT INTO empleados VALUES(190, 121, 350,'1942/05/12', '1972/02/11', 300, NULL, 4, 'VEIGA, JULIANA');
INSERT INTO empleados VALUES(210, 100, 200,'1950/09/28', '1969/01/22', 380, NULL, 2, 'GALVEZ, PILAR');
INSERT INTO empleados VALUES(240, 111, 760,'1952/02/26', '1976/02/24', 280, 100, 3, 'SANZ, LAVINIA');
INSERT INTO empleados VALUES(250, 100, 250,'1956/10/27', '1977/01/03', 450, NULL, 0, 'ALBA, ADRIANA');
INSERT INTO empleados VALUES(260, 100, 220,'1953/12/03', '1978/07/12', 720, NULL, 6, 'LOPEZ, ANTONIO');
INSERT INTO empleados VALUES(270, 112, 800,'1955/05/21', '1976/09/10', 380, 80, 3, 'GARCIA, OCTAVIO');
INSERT INTO empleados VALUES(280, 130, 410,'1958/01/11', '1981/10/08', 290, NULL, 5, 'FLOR,DOROTEA');
INSERT INTO empleados VALUES(285, 122, 620,'1959/10/25', '1978/02/15', 380, NULL, 0, 'POLO, OTILIA');
INSERT INTO empleados VALUES(290, 120, 910,'1957/11/30', '1978/02/14', 270, NULL, 3, 'GIL, GLORIA');
INSERT INTO empleados VALUES(310, 130, 480,'1956/11/21', '1981/01/15', 420, NULL, 0, 'GARCIA, AUGUSTO');
INSERT INTO empleados VALUES(320, 122, 620,'1967/12/25', '1988/02/05', 405, NULL, 2, 'SANZ, CORNELIO');
INSERT INTO empleados VALUES(330, 112, 850,'1958/08/19', '1982/03/01', 280, 90, 0, 'DIEZ, AMELIA');
INSERT INTO empleados VALUES(350, 122, 610,'1959/04/13', '1994/09/10', 450, NULL, 1, 'CAMPS, AURELIO');
INSERT INTO empleados VALUES(360, 111, 750,'1958/10/29', '1978/10/10', 250, 100, 2, 'LARA, DORINDA');
INSERT INTO empleados VALUES(370, 121, 360,'1977/06/22', '1997/01/20', 190, NULL, 1, 'RUIZ, FABIOLA');
INSERT INTO empleados VALUES(380, 112, 880,'1978/03/30', '1998/01/01', 180, NULL, 0, 'MARTIN, MICAELA');
INSERT INTO empleados VALUES(390, 110, 500,'1976/02/19', '1996/10/08', 215, NULL, 1, 'MORAN, CARMEN');
INSERT INTO empleados VALUES(400, 111, 780,'1979/08/18', '1997/11/01', 185, NULL, 0, 'LARA, LUCRECIA');
INSERT INTO empleados VALUES(410, 122, 660,'1978/07/14', '1998/10/13', 175, NULL, 0, 'MUOZ, AZUCENA');
INSERT INTO empleados VALUES(420, 130, 450,'1976/10/22', '1998/11/19', 400, NULL, 0, 'FIERRO, CLAUDIA');
INSERT INTO empleados VALUES(430, 122, 650,'1977/02/26', '1998/11/19', 210, NULL, 1, 'MORA, VALERIANA');
INSERT INTO empleados VALUES(440, 111, 760,'1976/09/26', '1996/02/28', 210, 100, 0, 'DURAN, LIVIA');
INSERT INTO empleados VALUES(450, 112, 880,'1976/10/21', '1996/02/28', 210, 100, 0, 'PEREZ, SABINA');
INSERT INTO empleados VALUES(480, 111, 760,'1975/04/04', '1996/02/28', 210, 100, 1, 'PINO, DIANA');
INSERT INTO empleados VALUES(490, 112, 880,'1974/06/06', '1998/01/01', 180, 100, 0, 'TORRES, HORACIO');
INSERT INTO empleados VALUES(500, 111, 750,'1975/10/08', '1997/01/01', 200, 100, 0, 'VAZQUEZ, HONORIA');
INSERT INTO empleados VALUES(510, 110, 550,'1976/05/04', '1996/11/01', 200, NULL, 1, 'CAMPOS, ROMULO');
INSERT INTO empleados VALUES(550, 111, 780,'1980/01/10', '1998/01/21', 100, 120, 0, 'SANTOS, SANCHO');

-- PROCEDIMIENTOS ALMACENADOS

DELIMITER $$

CREATE FUNCTION totalEmpleados (p_departamento INTEGER)
    RETURNS INTEGER
    READS SQL DATA
BEGIN
    DECLARE v_num_total INTEGER;
    SELECT COUNT(*)
    INTO v_num_total
    FROM empleados
    WHERE numde=p_departamento;
    RETURN(v_num_total);
END $$

--

CREATE PROCEDURE jefeyPresupuesto (IN departamento INTEGER,
                               OUT director INTEGER,
                               OUT presupuesto INTEGER)
BEGIN
 -- 
     SELECT direc, presu
       INTO director, presupuesto
      FROM departamentos
      WHERE numde = departamento;
END $$

--

CREATE PROCEDURE pesetasAeuros (INOUT p_p1 DECIMAL(7,2) )
BEGIN
  SET p_p1=p_p1 / 166.386;
END $$

DELIMITER ;